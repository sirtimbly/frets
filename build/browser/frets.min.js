!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.frets={})}(this,function(e){"use strict";var t,r="http://www.w3.org/2000/svg",n=[],i=function(e,t){var r={};return Object.keys(e).forEach(function(t){r[t]=e[t]}),t&&Object.keys(t).forEach(function(e){r[e]=t[e]}),r},o=function(e,t){return e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties)},a=function(e){if("string"!=typeof e)throw new Error("Style values must be strings")},s=function(e,t,r){if(""!==t.vnodeSelector)for(var n=r;n<e.length;n++)if(o(e[n],t))return n;return-1},u=function(e,t,r,n){var i=e[t];if(""!==i.vnodeSelector){var a=i.properties;if(!(a?void 0===a.key?a.bind:a.key:void 0))for(var s=0;s<e.length;s++)if(s!==t){var u=e[s];if(o(u,i))throw new Error(r.vnodeSelector+" had a "+i.vnodeSelector+" child "+("added"===n?n:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.")}}},c=function(e){if(e.properties){var t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},l=[],d=!1,f=function(e){(e.children||[]).forEach(f),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},p=function(){d=!1,l.forEach(f),l.length=0},h=function(e){l.push(e),d||(d=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(p,{timeout:16}):setTimeout(p,16))},m=function(e){var t=e.domNode;if(e.properties){var r=e.properties.exitAnimation;if(r){t.style.pointerEvents="none";return void r(t,function(){t.parentNode&&(t.parentNode.removeChild(t),h(e))},e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),h(e))},v=function(e,t,n){!function(e,t,r){if(t)for(var n=0,i=t;n<i.length;n++){var o=i[n];y(o,e,void 0,r)}}(e,t.children,n),t.text&&(e.textContent=t.text),function(e,t,n){if(t)for(var i=n.eventHandlerInterceptor,o=Object.keys(t),s=o.length,u=function(s){var u,c=o[s],l=t[c];if("className"===c)throw new Error('Property "className" is not supported, use "class".');if("class"===c)g(e,l,!0);else if("classes"===c)for(var d=Object.keys(l),f=d.length,p=0;p<f;p++){var h=d[p];l[h]&&e.classList.add(h)}else if("styles"===c){var m=Object.keys(l),v=m.length;for(p=0;p<v;p++){var y=m[p],w=l[y];w&&(a(w),n.styleApplyer(e,y,w))}}else if("key"!==c&&null!=l){var b=typeof l;"function"===b?0===c.lastIndexOf("on",0)&&(i&&(l=i(c,l,e,t)),"oninput"===c&&(u=l,l=function(e){u.apply(this,[e]),e.target["oninput-value"]=e.target.value}),e[c]=l):n.namespace===r?"href"===c?e.setAttributeNS("http://www.w3.org/1999/xlink",c,l):e.setAttribute(c,l):"string"===b&&"value"!==c&&"innerHTML"!==c?e.setAttribute(c,l):e[c]=l}},c=0;c<s;c++)u(c)}(e,t.properties,n),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,n,t.vnodeSelector,t.properties,t.children])},y=function(e,t,n,o){var a,s=0,u=e.vnodeSelector,c=t.ownerDocument;if(""===u)a=e.domNode=c.createTextNode(e.text),void 0!==n?t.insertBefore(a,n):t.appendChild(a);else{for(var l=0;l<=u.length;++l){var d=u.charAt(l);if(l===u.length||"."===d||"#"===d){var f=u.charAt(s-1),p=u.slice(s,l);"."===f?a.classList.add(p):"#"===f?a.id=p:("svg"===p&&(o=i(o,{namespace:r})),void 0!==o.namespace?a=e.domNode=c.createElementNS(o.namespace,p):(a=e.domNode=e.domNode||c.createElement(p),"input"===p&&e.properties&&void 0!==e.properties.type&&a.setAttribute("type",e.properties.type)),void 0!==n?t.insertBefore(a,n):a.parentNode!==t&&t.appendChild(a)),s=l+1}}v(a,e,o)}},g=function(e,t,r){t&&t.split(" ").forEach(function(t){return e.classList.toggle(t,r)})};t=function(e,l,d){var f=e.domNode,p=!1;if(e===l)return!1;var h=!1;if(""===l.vnodeSelector){if(l.text!==e.text){var v=f.ownerDocument.createTextNode(l.text);return f.parentNode.replaceChild(v,f),l.domNode=v,p=!0}l.domNode=f}else 0===l.vnodeSelector.lastIndexOf("svg",0)&&(d=i(d,{namespace:r})),e.text!==l.text&&(h=!0,void 0===l.text?f.removeChild(f.firstChild):f.textContent=l.text),l.domNode=f,h=function(e,r,i,a,l){if(i===a)return!1;a=a||n;for(var d,f=(i=i||n).length,p=a.length,h=0,v=0,g=!1;v<p;){var w=h<f?i[h]:void 0,b=a[v];if(void 0!==w&&o(w,b))g=t(w,b,l)||g,h++;else{var P=s(i,b,h+1);if(P>=0){for(d=h;d<P;d++)m(i[d]),u(i,d,e,"removed");g=t(i[P],b,l)||g,h=P+1}else y(b,r,h<f?i[h].domNode:void 0,l),c(b),u(a,v,e,"added")}v++}if(f>h)for(d=h;d<f;d++)m(i[d]),u(i,d,e,"removed");return g}(l,f,e.children,l.children,d)||h,h=function(e,t,n,i){if(n){for(var o=!1,s=Object.keys(n),u=s.length,c=0;c<u;c++){var l=s[c],d=n[l],f=t[l];if("class"===l)f!==d&&(g(e,f,!1),g(e,d,!0));else if("classes"===l)for(var p=e.classList,h=Object.keys(d),m=h.length,v=0;v<m;v++){var y=h[v],w=!!d[y];w!==!!f[y]&&(o=!0,w?p.add(y):p.remove(y))}else if("styles"===l){var b=Object.keys(d),P=b.length;for(v=0;v<P;v++){var x=b[v],A=d[x];A!==f[x]&&(o=!0,A?(a(A),i.styleApplyer(e,x,A)):i.styleApplyer(e,x,""))}}else if(d||"string"!=typeof f||(d=""),"value"===l){var j=e[l];j!==d&&(e["oninput-value"]?j===e["oninput-value"]:d!==f)&&(e[l]=d,e["oninput-value"]=void 0),d!==f&&(o=!0)}else if(d!==f){var O=typeof d;"function"===O&&i.eventHandlerInterceptor||(i.namespace===r?"href"===l?e.setAttributeNS("http://www.w3.org/1999/xlink",l,d):e.setAttribute(l,d):"string"===O&&"innerHTML"!==l?"role"===l&&""===d?e.removeAttribute(l):e.setAttribute(l,d):e[l]!==d&&(e[l]=d),o=!0)}}return o}}(f,e.properties,l.properties,d)||h,l.properties&&l.properties.afterUpdate&&l.properties.afterUpdate.apply(l.properties.bind||l.properties,[f,d,l.vnodeSelector,l.properties,l.children]);return h&&l.properties&&l.properties.updateAnimation&&l.properties.updateAnimation(f,l.properties,e.properties),p};var w=function(e,r){return{getLastRender:function(){return e},update:function(n){if(e.vnodeSelector!==n.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");var i=e;e=n,t(i,n,r)},domNode:e.domNode}},b={namespace:void 0,performanceLogger:function(){},eventHandlerInterceptor:void 0,styleApplyer:function(e,t,r){e.style[t]=r}},P=function(e){return i(b,e)},x=function(e,t,r){return r=P(r),y(t,e,void 0,r),w(t,r)},A=function(e,t,r){return r=P(r),y(t,e.parentNode,e,r),w(t,r)},j=function(e,t,r){return r=P(r),t.domNode=e,v(e,t,r),w(t,r)},O=function(e,t,r){return r=P(r),y(t,e.parentNode,e,r),e.parentNode.removeChild(e),w(t,r)},F=function(e,t,r){for(var n=0,i=t.length;n<i;n++){var o=t[n];Array.isArray(o)?F(e,o,r):null!=o&&!1!==o&&("string"==typeof o&&(o={vnodeSelector:"",properties:void 0,children:void 0,text:o.toString(),domNode:null}),r.push(o))}};function k(e,t,r){if(Array.isArray(t))r=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||r&&("string"==typeof r||r.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");var n,i;return r&&1===r.length&&"string"==typeof r[0]?n=r[0]:r&&(F(e,r,i=[]),0===i.length&&(i=void 0)),{vnodeSelector:e,properties:t,children:i,text:""===n?void 0:n,domNode:null}}var N;N=Array.prototype.find?function(e,t){return e.find(t)}:function(e,t){return e.filter(t)[0]};var E=function(e,t,r){var n=function(n){r("domEvent",n);var i=t(),o=function(e,t){for(var r=[];e!==t;)r.push(e),e=e.parentNode;return r}(n.currentTarget,i.domNode);o.reverse();var a,s=function(e,t){var r=e;return t.forEach(function(e){r=r&&r.children?N(r.children,function(t){return t.domNode===e}):void 0}),r}(i.getLastRender(),o);return e.scheduleRender(),s&&(a=s.properties["on"+n.type].apply(s.properties.bind||this,arguments)),r("domEventProcessed",n),a};return function(e,t,r,i){return n}},S=function(e){var t,r,n=P(e),i=n.performanceLogger,o=!0,a=!1,s=[],u=[],c=function(e,r,o){var a;n.eventHandlerInterceptor=E(t,function(){return a},i),a=e(r,o(),n),s.push(a),u.push(o)},l=function(){if(r=void 0,o){o=!1,i("renderStart",void 0);for(var e=0;e<s.length;e++){var t=u[e]();i("rendered",void 0),s[e].update(t),i("patched",void 0)}i("renderDone",void 0),o=!0}};return t={renderNow:l,scheduleRender:function(){r||a||(r=requestAnimationFrame(l))},stop:function(){r&&(cancelAnimationFrame(r),r=void 0),a=!0},resume:function(){a=!1,o=!0,t.scheduleRender()},append:function(e,t){c(x,e,t)},insertBefore:function(e,t){c(A,e,t)},merge:function(e,t){c(j,e,t)},replace:function(e,t){c(O,e,t)},detach:function(e){for(var t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),s.splice(t,1)[0];throw new Error("renderFunction was not found")}}},R=function(){var e,t;return{invalidate:function(){t=void 0,e=void 0},result:function(r,n){if(e)for(var i=0;i<r.length;i++)e[i]!==r[i]&&(t=void 0);return t||(t=n(),e=r),t}}},T="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var q,C,I=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},n=function(e){return encodeURIComponent(e)},i=function(e){return decodeURIComponent(e)},o=function(e,t,r){return null===t?function(e,t){return"hidden"===t.nullFormat?"":"string"===t.nullFormat?e+"=null":e}(e,r):"boolean"==typeof t?function(e,t,r){return"empty-true"===r.booleanFormat&&t?e:e+"="+("unicode"===r.booleanFormat?t?"✓":"✗":t.toString())}(e,t,r):Array.isArray(t)?function(e,t,r){var i=function(e){return"index"===e.arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}}(r);return t.map(function(t,r){return i(e,r)+"="+n(t)}).join("&")}(e,t,r):e+"="+n(t)},a=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},s=function(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}},u=function(e,t){var n=r(t);return a(e).split("&").reduce(function(e,t){var r=t.split("="),o=r[0],a=r[1],u=s(o),c=u.hasBrackets,l=u.name,d=e[l],f=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}else if("unicode"===t.booleanFormat){if("✓"===i(e))return!0;if("✗"===i(e))return!1}else if("string"===t.nullFormat&&"null"===e)return null;return i(e)}(a,n);return e[l]=void 0===d?c?[f]:f:[].concat(d,f),e},{})};t.parse=u,t.build=function(e,t){var n=r(t);return Object.keys(e).filter(function(t){return void 0!==e[t]}).map(function(t){return o(t,e[t],n)}).filter(Boolean).join("&")},t.omit=function(e,t,n){var i=r(n);if(""===a(e))return{querystring:"",removedParams:{}};var o=e.split("&").reduce(function(e,r){var n=e[0],i=e[1],o=r.split("=")[0],a=s(o).name;return-1===t.indexOf(a)?[n.concat(r),i]:[n,i.concat(r)]},[[],[]]),c=o[0],l=o[1];return{querystring:c.join("&"),removedParams:u(l.join("&"),i)}},t.keep=function(e,t,n){var i=r(n);if(""===a(e))return{keptParams:{},querystring:""};var o=e.split("&").reduce(function(e,r){var n=e[0],i=e[1],o=r.split("=")[0],a=s(o).name;return t.indexOf(a)>=0?[n.concat(r),i]:[n,i.concat(r)]},[[],[]]),c=o[0];o[1];return{keptParams:u(c.join("&"),i),querystring:c.join("&")}}}(q={exports:{}},q.exports),q.exports);(C=I)&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")&&C.default;var V=I.parse,$=I.build,M=(I.omit,I.keep,Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}),z=function(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@]+")+")"},L=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(z(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+z(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],_=function(e,t){if(void 0===t&&(t=[]),!L.some(function(r){var n=e.match(r.pattern);return!!n&&(t.push({type:r.name,match:n[0],val:n.slice(1,2),otherVal:n.slice(2),regex:r.regex instanceof Function?r.regex(n):r.regex}),n[0].length<e.length&&(t=_(e.substr(n[0].length),t)),!0)}))throw new Error("Could not parse path '"+e+"'");return t},Z=function(e){return e},Q=function(e){return null!=e},B=function(){function e(e){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.tokens=_(e),this.hasUrlParams=this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length>0,this.hasSpatParam=this.tokens.filter(function(e){return/splat$/.test(e.type)}).length>0,this.hasMatrixParams=this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length>0,this.hasQueryParams=this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length>0,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}return e.createPath=function(t){return new e(t)},e.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},e.prototype.test=function(e,t){var r=this,n=M({strictTrailingSlash:!1,queryParams:{}},t),i=function(e,t){return t?e:"\\/"===e?e:e.replace(/\\\/$/,"")+"(?:\\/)?"}(this.source,n.strictTrailingSlash),o=this.urlTest(e,i+(this.hasQueryParams?"(\\?.*$|$)":"$"),t);if(!o||!this.hasQueryParams)return o;var a=V(e,n.queryParams);return 0===Object.keys(a).filter(function(e){return!r.isQueryParam(e)}).length?(Object.keys(a).forEach(function(e){return o[e]=a[e]}),o):null},e.prototype.partialTest=function(e,t){var r=this,n=M({delimited:!0,queryParams:{}},t),i=function(e,t){return t?/(\/)$/.test(e)?e:e+"(\\/|\\?|\\.|;|$)":e}(this.source,n.delimited),o=this.urlTest(e,i,n);if(!o)return o;if(!this.hasQueryParams)return o;var a=V(e,n.queryParams);return Object.keys(a).filter(function(e){return r.isQueryParam(e)}).forEach(function(e){return function(e,t,r){void 0===r&&(r="");var n=e[t];return e[t]=void 0===n?r:Array.isArray(n)?n.concat(r):[n,r],e}(o,e,a[e])}),o},e.prototype.build=function(e,t){var r=this;void 0===e&&(e={});var n=M({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},t),i=Object.keys(e).filter(function(e){return!r.isQueryParam(e)}).reduce(function(t,n){if(!Q(e[n]))return t;var i=e[n],o=r.isQueryParam(n)?Z:encodeURI;return"boolean"==typeof i?t[n]=i:Array.isArray(i)?t[n]=i.map(o):t[n]=o(i),t},{});if(this.urlParams.some(function(t){return!Q(e[t])})){var o=this.urlParams.filter(function(t){return!Q(e[t])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+o.join(", ")+" }")}if(!n.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+z(e.otherVal[0])+"$").test(i[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var a=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+i[e.val[0]]:/^url-parameter/.test(e.type)?i[e.val[0]]:e.match}).join("");if(n.ignoreSearch)return a;var s=this.queryParams.filter(function(t){return-1!==Object.keys(e).indexOf(t)}).reduce(function(t,r){return t[r]=e[r],t},{}),u=$(s,n.queryParams);return u?a+"?"+u:a},e.prototype.getParams=function(e){var t=e instanceof RegExp?function(t){return e.test(t.type)}:function(t){return t.type===e};return this.tokens.filter(t).map(function(e){return e.val[0]})},e.prototype.urlTest=function(e,t,r){var n=this,i=(void 0===r?{}:r).caseSensitive,o=new RegExp("^"+t,void 0!==i&&i?"":"i"),a=e.match(o);return a?this.urlParams.length?a.slice(1,this.urlParams.length+1).reduce(function(e,t,r){return e[n.urlParams[r]]=decodeURIComponent(t),e},{}):{}:null},e}();var U="Expected a function",D=NaN,H="[object Symbol]",W=/^\s+|\s+$/g,J=/^[-+]0x[0-9a-f]+$/i,Y=/^0b[01]+$/i,G=/^0o[0-7]+$/i,K=parseInt,X="object"==typeof T&&T&&T.Object===Object&&T,ee="object"==typeof self&&self&&self.Object===Object&&self,te=X||ee||Function("return this")(),re=Object.prototype.toString,ne=Math.max,ie=Math.min,oe=function(){return te.Date.now()};function ae(e,t,r){var n,i,o,a,s,u,c=0,l=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError(U);function p(t){var r=n,o=i;return n=i=void 0,c=t,a=e.apply(o,r)}function h(e){var r=e-u;return void 0===u||r>=t||r<0||d&&e-c>=o}function m(){var e=oe();if(h(e))return v(e);s=setTimeout(m,function(e){var r=t-(e-u);return d?ie(r,o-(e-c)):r}(e))}function v(e){return s=void 0,f&&n?p(e):(n=i=void 0,a)}function y(){var e=oe(),r=h(e);if(n=arguments,i=this,u=e,r){if(void 0===s)return function(e){return c=e,s=setTimeout(m,t),l?p(e):a}(u);if(d)return s=setTimeout(m,t),p(u)}return void 0===s&&(s=setTimeout(m,t)),a}return t=ue(t)||0,se(r)&&(l=!!r.leading,o=(d="maxWait"in r)?ne(ue(r.maxWait)||0,t):o,f="trailing"in r?!!r.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=u=i=s=void 0},y.flush=function(){return void 0===s?a:v(oe())},y}function se(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ue(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&re.call(e)==H}(e))return D;if(se(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=se(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(W,"");var r=Y.test(e);return r||G.test(e)?K(e.slice(2),r?2:8):J.test(e)?D:+e}var ce=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError(U);return se(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),ae(e,t,{leading:n,maxWait:t,trailing:i})},le=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})};e.FRETS=class{constructor(e,t){this.actions=t,this.routes={},this.cachedNode=k("div#default"),this.allowAsyncRender=!0,this.stateIsMutated=!1,this.stateRenderer=((e="default")=>k(`div#${e}`,["Default FRETS: assign a render method using `.registerView()`"])),this.registerView=(e=>{this.stateRenderer=(()=>k(`div#${this.rootId}`,[e(this)]))}),this.registerViewAsync=(e=>le(this,void 0,void 0,function*(){this.stateRenderer=(()=>(this.allowAsyncRender&&e(this).then(e=>{this.cache.invalidate(),this.allowAsyncRender=!1,this.cachedNode=e,this.render(this.modelProps)}),k(`div#${this.rootId}`,[this.cachedNode])))})),this.render=((e,t=!0)=>{this.cache.result([JSON.stringify(e)],()=>(this.stateIsMutated&&!t||this.mutate(e),this.projector.scheduleRender(),this.stateIsMutated=!1,e))}),this.mountTo=(e=>{this.mutate(this.modelProps),this.projector.merge(document.getElementById(e),this.stateRenderer)}),this.makeActionStately=((e,t)=>t=>ce(r=>{this.allowAsyncRender=!0;const n=t(r,this.modelProps);this.mutate(n),e(this.modelProps)},16)),this.validator=((e,t)=>[e,!0]),this.calculator=((e,t)=>e);const r=this;this.mutateProps(e),this.projector=S(),this.cache=R(),this.registerAction=this.makeActionStately(function(e){r.render(e,!1)},this.modelProps),window.onpopstate=function(e){r.render(r.modelProps)}}get modelProps(){return this.externalModelProps}getRouteLink(e,t){return!(!this.routes||!this.routes[e])&&this.routes[e].spec.build(t||{})}navToRoute(e,t){const r=this.getRouteLink(e,t);r&&this.navToPath(r)}navToPath(e){try{window.history.pushState(this.modelProps,"",e)}catch(t){window.location.pathname=e}}registerField(e,t){if(!this.modelProps.registeredFieldsValues[e]){const r=Object.assign({},this.modelProps,{registeredFieldValidationErrors:Object.assign({[e]:[]},this.modelProps.registeredFieldValidationErrors),registeredFieldsValues:Object.assign({[e]:t||""},this.modelProps.registeredFieldsValues)});this.mutateProps(r)}return this.actions.registeredFieldActions[e]||(this.actions.registeredFieldActions[e]=this.registerAction((t,r)=>{const n=Object.assign({},r,{registeredFieldsValues:Object.assign({},r.registeredFieldsValues)});return n.registeredFieldsValues[e]=t.target.value,n})),this.getField(e)}getField(e){return{handler:this.actions.registeredFieldActions[e],validationErrors:this.modelProps.registeredFieldValidationErrors[e],value:this.modelProps.registeredFieldsValues[e]}}registerRoute(e,t,r){this.routes[e]={calculator:r,spec:new B(t)}}mutateProps(e){this.externalModelProps=function e(t){return Object.isFrozen(t)?t:(Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(r){!t.hasOwnProperty(r)||null===t[r]||"object"!=typeof t[r]&&"function"!=typeof t[r]||Object.isFrozen(t[r])||e(t[r])}),t)}(e)}mutate(e){let t=!0,r=e;this.stateIsMutated=!0,[r,t]=this.validator(r,this.modelProps),t?(r=this.applyRouteFunction(r),r=this.calculator(r,this.modelProps),this.mutateProps(r)):this.mutateProps(r)}applyRouteFunction(e){let t=Object.assign({},e);for(const e in this.routes)if(this.routes.hasOwnProperty(e)){const r=this.routes[e],n=r.spec.test(window.location.pathname);if(n)return t=r.calculator(e,n,t)}return t}},e.PropsWithFields=class{constructor(){this.registeredFieldsValues={},this.registeredFieldValidationErrors={}}},e.ActionsWithFields=class{constructor(){this.registeredFieldActions={}}},Object.defineProperty(e,"__esModule",{value:!0})});
